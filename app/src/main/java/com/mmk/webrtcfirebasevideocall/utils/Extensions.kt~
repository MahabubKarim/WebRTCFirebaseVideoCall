package com.mmk.webrtcfirebasevideocall.utils

import android.Manifest
import android.os.Build
import android.widget.Toast
import androidx.annotation.RequiresApi
import androidx.appcompat.app.AppCompatActivity
import com.mmk.webrtcfirebasevideocall.R
import com.permissionx.guolindev.PermissionX

fun AppCompatActivity.getCameraAndMicPermission(success: () -> Unit) {
    PermissionX.init(this)
        .permissions(
            android.Manifest.permission.CAMERA,
            android.Manifest.permission.RECORD_AUDIO,
            android.Manifest.permission.POST_NOTIFICATIONS
        )
        .request { allGranted, _, _ ->
            if (allGranted) {
                success()
            } else {
                Toast.makeText(
                    this,
                    getString(R.string.camera_and_mic_required),
                    Toast.LENGTH_SHORT
                )
                    .show()
            }
        }
}

@RequiresApi(Build.VERSION_CODES.UPSIDE_DOWN_CAKE)
fun AppCompatActivity.getMediaProjectionAndCaptureAudioOutputPermission(success: () -> Unit) {
    PermissionX.init(this)
        .permissions(
            Manifest.permission.FOREGROUND_SERVICE_MEDIA_PROJECTION,
            Manifest.permission.CAMERA,
            Manifest.permission.RECORD_AUDIO
        )
        .request { allGranted, _, _ ->
            if (allGranted) {
                success()
            } else {
                Toast.makeText(this, "Permissions are required", Toast.LENGTH_SHORT).show()
            }
        }
}